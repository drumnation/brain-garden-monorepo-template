---
description: Express.js backend architecture patterns
globs:
  - "apps/server/**/*"
  - "apps/*/src/modules/**/*"
  - "apps/*/controllers/**/*"
alwaysApply: false
scopes:
  - express
  - backend
  - api
  - node
  - mongodb
---

# Express Architecture

## Structure
```
src/
├─ modules/              # Feature modules
│   └─ <feature>/
│       ├─ <feature>.controller.ts
│       ├─ <feature>.service.ts
│       ├─ <feature>.repo.ts
│       └─ index.ts
├─ shared/               # App-internal
├─ infra/                # HTTP, DB setup
└─ main.ts
```

## File Naming
`<feature>.<role>.ts` where role = controller | service | repo | schema | dto | types | middleware

## Functional DI Pattern
```typescript
// Repository
export const makeUserRepo = (deps: { db: DbClient }) => ({
  list: () => deps.db.query<User[]>('SELECT * FROM users'),
});

// Controller
export const makeGetUsers = (userRepo: ReturnType<typeof makeUserRepo>) =>
  async (_req, res) => res.json(await userRepo.list());
```

## Limits (ESLint enforced)
- Max file: 500 lines
- Max function: 75 lines
- Complexity: ≤10
- Nesting: ≤4
