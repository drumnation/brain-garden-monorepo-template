---
description: Rules system architecture and modification protocol - ALWAYS read this first
globs:
  - "**/*"
alwaysApply: true
scopes:
  - monorepo
  - global
---

# Meta-Rules: Rules System Architecture

**⚠️ CRITICAL: READ THIS FIRST BEFORE FOLLOWING ANY OTHER RULES**

This file defines how the rules system works and how to modify it. All AI platforms (Claude, Gemini, Cline, Windsurf, LangGraph agents) must understand this architecture.

## Rules System Architecture

### Source of Truth: Modular .mdc Files
All rules are defined in **modular `.rules.mdc` files** in `.cursor/rules/`:
- `00-meta-rules-system.rules.mdc` - This file (meta-rules)
- `01-foundation.rules.mdc` - Core monorepo foundation
- `02-validation-testing.rules.mdc` - Brain monitor & TDD
- `03-frontend-patterns.rules.mdc` - Component patterns
- `04-react-standards.rules.mdc` - React best practices
- `05-backend-express.rules.mdc` - Express architecture
- `06-backend-functional.rules.mdc` - Functional patterns
- `07-documentation.rules.mdc` - Documentation & versioning
- `08-workflow.rules.mdc` - PR creation & commands
- `09-ai-documentation-maintenance.rules.mdc` - AI documentation maintenance

### Generated Files (DO NOT EDIT)
These files are **auto-generated** from the source `.rules.mdc` files:

**Never edit these files directly:**
- `docs/ai-platforms/CLAUDE.md` (Monorepo root context)
- `apps/web/CLAUDE.md` (React/Frontend context)
- `apps/server/CLAUDE.md` (Express/Backend context)
- `packages/universal/CLAUDE.md` (Universal package context)
- `tooling/CLAUDE.md` (Tooling packages context)
- `docs/ai-platforms/GEMINI.md` (and all other GEMINI.md files)
- `docs/ai-platforms/AGENTS.md` (and all other AGENTS.md files)
- `docs/ai-platforms/.clinerules` (Cline platform)
- `docs/ai-platforms/.windsurfrules` (Windsurf platform)

### YAML Frontmatter Structure
Each `.rules.mdc` file MUST include YAML frontmatter:

```yaml
---
description: Brief description of when to apply this rule
globs:
  - "**/*.ts"  # File patterns this rule applies to
  - "**/*.tsx"
alwaysApply: true  # or false
scopes:
  - monorepo  # Which contexts include this rule
  - global
  - react
  - frontend
---
```

**Available scopes:**
- `global` - Applies everywhere (all contexts)
- `monorepo` - Monorepo-wide rules
- `react`, `frontend`, `ui`, `components`, `vite`, `mantine` - Frontend/React contexts
- `express`, `backend`, `api`, `node`, `mongodb` - Backend/Server contexts
- `shared` - Universal package
- `tooling` - Tooling packages

**Special scope:**
- `*` - Include ALL rules (used only for monorepo root context)

## Rule Modification Protocol

### ⚠️ NEVER EDIT GENERATED FILES DIRECTLY

**ALWAYS follow this workflow:**

1. **Edit source `.rules.mdc` files** in `.cursor/rules/`
2. **Run the build command** to regenerate all platform files:
   ```bash
   pnpm rules:build
   ```
3. **Verify the output** in generated files

### Watch Mode (For Active Development)
```bash
pnpm rules:watch
```
This automatically rebuilds when `.rules.mdc` files change.

### What Happens When You Build
The build script (`.cursor/sync/build-consolidated-rules.ts`):
1. Reads all `.rules.mdc` files
2. Filters rules by scope for each context
3. Generates hierarchical CLAUDE.md files (5 contexts)
4. Generates hierarchical GEMINI.md files (5 contexts)
5. Generates hierarchical AGENTS.md files (5 contexts)
6. Generates single-file formats (.clinerules, .windsurfrules)

### Adding a New Rule File
1. Create `.cursor/rules/XX-new-rule.rules.mdc`
2. Add YAML frontmatter with description, globs, alwaysApply, and scopes
3. Write the rule content
4. Run `pnpm rules:build`
5. Verify the rule appears in appropriate generated files

### Modifying an Existing Rule
1. Edit the source `.rules.mdc` file
2. Run `pnpm rules:build`
3. Verify changes in generated files

### Removing a Rule
1. Delete (or rename with `_` prefix) the `.rules.mdc` file
2. Run `pnpm rules:build`
3. Verify rule is removed from generated files

## Documentation Placement Policy

**STRICT RULE: No documentation files in repository root**

### Allowed in Root Directory
- `README.md` - Project overview and quick start
- `CHANGELOG.md` - Version history
- `.env.example` - Environment variable template
- Configuration files (`.gitignore`, `tsconfig.json`, `package.json`, etc.)

### Required Placement for All Other Documentation
All other documentation MUST be placed under `/docs`:

```
/docs
├── architecture/        # System architecture, design decisions
├── features/           # Feature-specific documentation
├── development/        # Development guides, workflows
└── ai-platforms/       # AI platform rules (CLAUDE.md, GEMINI.md, etc.)
```

**Examples of PROHIBITED files in root:**
- ❌ `DOCUMENTATION_AUDIT.md` → Move to `/docs/development/`
- ❌ `ENV_SETUP_GUIDE.md` → Move to `/docs/development/`
- ❌ `ARCHITECTURE.md` → Move to `/docs/architecture/`
- ❌ `FEATURE_SPEC.md` → Move to `/docs/features/`
- ❌ Any other `.md` files except README.md and CHANGELOG.md

**Rationale:**
- Keeps root directory clean and focused
- Provides clear information architecture
- Prevents documentation sprawl
- Makes it easy to find documentation

## Quick Reference

### Daily Workflow Commands
```bash
# Edit a rule
vim .cursor/rules/03-frontend-patterns.rules.mdc

# Rebuild (required after editing)
pnpm rules:build

# Watch mode (auto-rebuild)
pnpm rules:watch
```

### File Organization
```
.cursor/
├── rules/              # SOURCE OF TRUTH (edit these)
│   ├── 00-meta-rules-system.rules.mdc
│   ├── 01-foundation.rules.mdc
│   ├── 02-validation-testing.rules.mdc
│   └── ...
├── sync/               # Build tooling
│   └── build-consolidated-rules.ts
└── docs/               # Documentation

docs/ai-platforms/      # GENERATED (never edit)
├── CLAUDE.md
├── GEMINI.md
├── AGENTS.md
├── .clinerules
└── .windsurfrules

apps/web/               # GENERATED (never edit)
├── CLAUDE.md
├── GEMINI.md
└── AGENTS.md

apps/server/            # GENERATED (never edit)
├── CLAUDE.md
├── GEMINI.md
└── AGENTS.md

packages/universal/     # GENERATED (never edit)
├── CLAUDE.md
├── GEMINI.md
└── AGENTS.md

tooling/                # GENERATED (never edit)
├── CLAUDE.md
├── GEMINI.md
└── AGENTS.md
```

### Build Script Locations
- **Script:** `.cursor/sync/build-consolidated-rules.ts`
- **Commands defined in:** `package.json` (root)

## Why This Matters

### For AI Assistants
- **Cursor** reads `.mdc` files directly from `.cursor/rules/`
- **Claude Code** uses `CLAUDE.md` files scoped to working directory
- **Gemini** uses `GEMINI.md` files scoped to working directory
- **Cline** uses `.clinerules` (single-file format)
- **Windsurf** uses `.windsurfrules` (single-file format)
- **LangGraph/Agents** use `AGENTS.md` files scoped to context

### For Developers
- Single source of truth prevents rule conflicts
- Hierarchical contexts provide focused, relevant rules
- Generated files ensure consistency across platforms
- Documentation placement policy keeps repository organized

### For the Project
- Maintainable: Edit once, deploy everywhere
- Scalable: Easy to add new rules or platforms
- Discoverable: Clear structure makes rules easy to find
- Auditable: Git history tracks rule changes in source files

---

**Remember:** If you're an AI assistant and you notice documentation in the root directory (except README.md, CHANGELOG.md, .env.example), suggest moving it to the appropriate `/docs` subdirectory.

**Remember:** If you're an AI assistant modifying rules, ALWAYS edit the source `.rules.mdc` files and run `pnpm rules:build`. NEVER edit generated files (CLAUDE.md, GEMINI.md, AGENTS.md, .clinerules, .windsurfrules) directly.
